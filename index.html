<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bonicalc - Calculadora de Bonificaciones Hipotecarias</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/lucide.min.css">
    <style>
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .result-card {
            transition: all 0.3s ease;
        }
        .result-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100">
    <div class="max-w-7xl mx-auto p-4">
        <div class="bg-white rounded-2xl shadow-2xl overflow-hidden">
            <!-- Header -->
            <div class="bg-gradient-to-r from-blue-600 to-purple-600 p-8 text-white">
                <div class="flex items-center gap-3 mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="4" y="2" width="16" height="20" rx="2"></rect>
                        <path d="M8 6h8"></path>
                        <path d="M8 10h8"></path>
                        <path d="M8 14h8"></path>
                        <path d="M8 18h6"></path>
                    </svg>
                    <h1 class="text-3xl font-bold">Bonicalc</h1>
                </div>
                <p class="text-blue-100 text-lg">
                    Compara si te conviene la hipoteca bonificada del banco o contratar los productos por tu cuenta
                </p>
            </div>

            <!-- Formulario -->
            <div class="p-8">
                <!-- Datos básicos -->
                <div class="grid md:grid-cols-2 gap-8 mb-8">
                    <div class="space-y-6">
                        <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-600">
                                <line x1="12" y1="1" x2="12" y2="23"></line>
                                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                            </svg>
                            Datos de tu hipoteca
                        </h2>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Capital pendiente (€)
                            </label>
                            <input
                                type="number"
                                id="capitalPendiente"
                                value="150000"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
                                placeholder="150000"
                            />
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Plazo restante (años)
                            </label>
                            <input
                                type="number"
                                id="plazoRestante"
                                value="25"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
                                placeholder="25"
                            />
                        </div>
                    </div>

                    <div class="space-y-6">
                        <h2 class="text-xl font-semibold text-gray-800 mb-4 flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-purple-600">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M15 9.354a4 4 0 1 0 0 5.292"></path>
                            </svg>
                            Tipos de interés
                        </h2>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Tipo de interés SIN bonificar (%)
                            </label>
                            <input
                                type="number"
                                id="tipoSinBonificar"
                                step="0.01"
                                value="3.5"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
                                placeholder="3.5"
                            />
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Tipo de interés CON bonificación (%)
                            </label>
                            <input
                                type="number"
                                id="tipoBonificado"
                                step="0.01"
                                value="2.5"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
                                placeholder="2.5"
                            />
                        </div>
                    </div>
                </div>

                <!-- Comparador de productos -->
                <div class="mt-8">
                    <h2 class="text-xl font-semibold text-gray-800 mb-6 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-green-600">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                        </svg>
                        Comparador de productos vinculados
                    </h2>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b-2 border-gray-200">
                                    <th class="text-left py-3 px-4 font-semibold text-gray-700">Producto</th>
                                    <th class="text-center py-3 px-4 font-semibold text-gray-700">Activo</th>
                                    <th class="text-center py-3 px-4 font-semibold text-gray-700">
                                        <div class="flex items-center justify-center gap-1">
                                            <span>Coste con banco</span>
                                            <span class="text-xs text-gray-500">(€/año)</span>
                                        </div>
                                    </th>
                                    <th class="text-center py-3 px-4 font-semibold text-gray-700">
                                        <div class="flex items-center justify-center gap-1">
                                            <span>Coste externo</span>
                                            <span class="text-xs text-gray-500">(€/año)</span>
                                        </div>
                                    </th>
                                    <th class="text-center py-3 px-4 font-semibold text-gray-700">Diferencia</th>
                                </tr>
                            </thead>
                            <tbody id="productosBody">
                                <!-- Se llenará con JavaScript -->
                            </tbody>
                            <tfoot>
                                <tr class="border-t-2 border-gray-300 bg-gray-50">
                                    <td class="py-4 px-4 font-semibold text-gray-700">TOTAL ANUAL</td>
                                    <td></td>
                                    <td class="text-center py-4 px-4 font-bold text-gray-900" id="totalBanco">0€</td>
                                    <td class="text-center py-4 px-4 font-bold text-gray-900" id="totalExterno">0€</td>
                                    <td class="text-center py-4 px-4 font-bold" id="totalDiferencia">0€</td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>

                <!-- Resultados -->
                <div id="resultados" class="mt-8 space-y-6 hidden">
                    <!-- Se llenará con JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Datos de productos
        const productos = {
            seguroHogar: { nombre: 'Seguro de hogar', banco: 300, externo: 200, activo: true, icono: 'shield' },
            seguroVida: { nombre: 'Seguro de vida', banco: 400, externo: 250, activo: true, icono: 'shield' },
            tarjetas: { nombre: 'Tarjetas y comisiones', banco: 60, externo: 0, activo: true, icono: 'credit-card' },
            planPensiones: { nombre: 'Plan de pensiones', banco: 0, externo: 0, activo: false, icono: 'wallet' },
            otros: { nombre: 'Otros productos', banco: 100, externo: 50, activo: true, icono: 'dollar-sign' }
        };

        // Función para calcular la cuota mensual
        function calcularCuotaMensual(capital, plazoAnos, tipoInteres) {
            const meses = plazoAnos * 12;
            const interesMensual = tipoInteres / 100 / 12;
            
            if (interesMensual === 0) return capital / meses;
            
            const cuota = capital * (interesMensual * Math.pow(1 + interesMensual, meses)) / 
                          (Math.pow(1 + interesMensual, meses) - 1);
            
            return cuota;
        }

        // Función para formatear números
        function formatNumber(num, decimals = 2) {
            return num.toLocaleString('es-ES', { minimumFractionDigits: decimals, maximumFractionDigits: decimals });
        }

        // Función para actualizar la tabla de productos
        function actualizarTablaProductos() {
            const tbody = document.getElementById('productosBody');
            tbody.innerHTML = '';
            
            Object.entries(productos).forEach(([key, producto]) => {
                const tr = document.createElement('tr');
                tr.className = 'border-b border-gray-100 hover:bg-gray-50';
                
                const diferencia = producto.banco - producto.externo;
                
                tr.innerHTML = `
                    <td class="py-4 px-4">
                        <div class="flex items-center gap-2">
                            <span class="font-medium text-gray-700">${producto.nombre}</span>
                        </div>
                    </td>
                    <td class="text-center py-4 px-4">
                        <input
                            type="checkbox"
                            ${producto.activo ? 'checked' : ''}
                            onchange="toggleProducto('${key}')"
                            class="w-5 h-5 text-blue-600 rounded focus:ring-blue-500"
                        />
                    </td>
                    <td class="text-center py-4 px-4">
                        <input
                            type="number"
                            value="${producto.banco}"
                            onchange="actualizarProducto('${key}', 'banco', this.value)"
                            ${!producto.activo ? 'disabled' : ''}
                            class="w-24 px-2 py-1 border rounded text-center ${
                                producto.activo 
                                    ? 'border-gray-300 focus:ring-2 focus:ring-blue-500' 
                                    : 'border-gray-200 bg-gray-100 text-gray-400'
                            }"
                        />
                    </td>
                    <td class="text-center py-4 px-4">
                        <input
                            type="number"
                            value="${producto.externo}"
                            onchange="actualizarProducto('${key}', 'externo', this.value)"
                            ${!producto.activo ? 'disabled' : ''}
                            class="w-24 px-2 py-1 border rounded text-center ${
                                producto.activo 
                                    ? 'border-gray-300 focus:ring-2 focus:ring-blue-500' 
                                    : 'border-gray-200 bg-gray-100 text-gray-400'
                            }"
                        />
                    </td>
                    <td class="text-center py-4 px-4">
                        ${producto.activo ? `
                            <span class="font-semibold ${diferencia > 0 ? 'text-red-600' : 'text-green-600'}">
                                ${diferencia > 0 ? '+' : ''}${diferencia}€
                            </span>
                        ` : ''}
                    </td>
                `;
                
                tbody.appendChild(tr);
            });
            
            calcular();
        }

        // Función para toggle producto
        function toggleProducto(key) {
            productos[key].activo = !productos[key].activo;
            actualizarTablaProductos();
        }

        // Función para actualizar producto
        function actualizarProducto(key, campo, valor) {
            productos[key][campo] = Number(valor);
            actualizarTablaProductos();
        }

        // Función principal de cálculo
        function calcular() {
            const capitalPendiente = Number(document.getElementById('capitalPendiente').value);
            const plazoRestante = Number(document.getElementById('plazoRestante').value);
            const tipoSinBonificar = Number(document.getElementById('tipoSinBonificar').value);
            const tipoBonificado = Number(document.getElementById('tipoBonificado').value);
            
            if (!capitalPendiente || !plazoRestante || !tipoSinBonificar || !tipoBonificado) return;
            
            // Calcular costes anuales de productos
            let costeAnualBanco = 0;
            let costeAnualExterno = 0;
            
            Object.values(productos).forEach(producto => {
                if (producto.activo) {
                    costeAnualBanco += producto.banco;
                    costeAnualExterno += producto.externo;
                }
            });
            
            // Actualizar totales en la tabla
            document.getElementById('totalBanco').textContent = formatNumber(costeAnualBanco, 0) + '€';
            document.getElementById('totalExterno').textContent = formatNumber(costeAnualExterno, 0) + '€';
            const totalDiferencia = costeAnualBanco - costeAnualExterno;
            document.getElementById('totalDiferencia').innerHTML = `
                <span class="${totalDiferencia > 0 ? 'text-red-600' : 'text-green-600'}">
                    ${totalDiferencia > 0 ? '+' : ''}${formatNumber(totalDiferencia, 0)}€
                </span>
            `;
            
            // Calcular cuotas
            const cuotaSinBonificar = calcularCuotaMensual(capitalPendiente, plazoRestante, tipoSinBonificar);
            const cuotaBonificada = calcularCuotaMensual(capitalPendiente, plazoRestante, tipoBonificado);
            
            // Calcular costes totales
            const costeTotalHipotecaSinBonificar = cuotaSinBonificar * plazoRestante * 12;
            const costeTotalHipotecaBonificada = cuotaBonificada * plazoRestante * 12;
            
            // Calcular ahorros
            const ahorroMensualHipoteca = cuotaSinBonificar - cuotaBonificada;
            const ahorroTotalIntereses = costeTotalHipotecaSinBonificar - costeTotalHipotecaBonificada;
            
            // Calcular costes totales de cada opción
            const costeTotalOpcionBanco = costeTotalHipotecaBonificada + (costeAnualBanco * plazoRestante);
            const costeTotalOpcionExterna = costeTotalHipotecaSinBonificar + (costeAnualExterno * plazoRestante);
            
            // Calcular diferencia
            const ahorroTotal = costeTotalOpcionExterna - costeTotalOpcionBanco;
            const ahorroAnual = (ahorroTotal / plazoRestante);
            const esRentable = ahorroTotal > 0;
            
            // Mostrar resultados
            mostrarResultados({
                cuotaSinBonificar,
                cuotaBonificada,
                ahorroMensualHipoteca,
                ahorroTotalIntereses,
                costeAnualBanco,
                costeAnualExterno,
                costeTotalOpcionBanco,
                costeTotalOpcionExterna,
                ahorroTotal,
                ahorroAnual,
                esRentable,
                plazoRestante,
                sobrecosteProductosBanco: totalDiferencia
            });
        }

        // Función para mostrar resultados
        function mostrarResultados(resultados) {
            const divResultados = document.getElementById('resultados');
            divResultados.classList.remove('hidden');
            
            divResultados.innerHTML = `
                <!-- Alerta principal -->
                <div class="fade-in p-6 rounded-xl ${resultados.esRentable 
                    ? 'bg-green-50 border-2 border-green-200' 
                    : 'bg-red-50 border-2 border-red-200'}">
                    <div class="flex items-start gap-3">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${resultados.esRentable ? 'text-green-600' : 'text-red-600'}">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="8" x2="12" y2="12"></line>
                            <line x1="12" y1="16" x2="12.01" y2="16"></line>
                        </svg>
                        <div class="flex-1">
                            <h3 class="text-lg font-semibold mb-2 ${resultados.esRentable ? 'text-green-800' : 'text-red-800'}">
                                ${resultados.esRentable 
                                    ? '✅ La hipoteca bonificada del banco SÍ te conviene' 
                                    : '❌ La hipoteca bonificada del banco NO te conviene'}
                            </h3>
                            <p class="${resultados.esRentable ? 'text-green-700' : 'text-red-700'}">
                                ${resultados.esRentable 
                                    ? `Ahorrarás ${formatNumber(resultados.ahorroTotal, 0)}€ durante la vida del préstamo`
                                    : `Pagarás ${formatNumber(Math.abs(resultados.ahorroTotal), 0)}€ de más durante la vida del préstamo`}
                            </p>
                            <p class="text-sm mt-2 ${resultados.esRentable ? 'text-green-600' : 'text-red-600'}">
                                Esto supone ${resultados.esRentable ? 'un ahorro' : 'un sobrecoste'} de ${formatNumber(Math.abs(resultados.ahorroAnual), 0)}€ al año
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Comparación visual -->
                <div class="grid md:grid-cols-2 gap-4 fade-in">
                    <div class="bg-blue-50 rounded-xl p-6 result-card">
                        <h4 class="font-semibold text-blue-900 mb-4 flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="4" y="2" width="16" height="20" rx="2"></rect>
                                <path d="M8 6h8"></path>
                                <path d="M8 10h8"></path>
                                <path d="M8 14h8"></path>
                            </svg>
                            Opción 1: Hipoteca bonificada + productos banco
                        </h4>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-blue-700">Cuota hipoteca:</span>
                                <span class="font-semibold text-blue-900">${formatNumber(resultados.cuotaBonificada)}€/mes</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-blue-700">Productos:</span>
                                <span class="font-semibold text-blue-900">${formatNumber(resultados.costeAnualBanco/12)}€/mes</span>
                            </div>
                            <div class="pt-3 border-t border-blue-200">
                                <div class="flex justify-between">
                                    <span class="font-semibold text-blue-900">Total mensual:</span>
                                    <span class="font-bold text-blue-900 text-lg">
                                        ${formatNumber(resultados.cuotaBonificada + resultados.costeAnualBanco/12)}€
                                    </span>
                                </div>
                            </div>
                            <div class="pt-2">
                                <div class="flex justify-between">
                                    <span class="text-sm text-blue-700">Coste total (${resultados.plazoRestante} años):</span>
                                    <span class="font-semibold text-blue-900">
                                        ${formatNumber(resultados.costeTotalOpcionBanco, 0)}€
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-purple-50 rounded-xl p-6 result-card">
                        <h4 class="font-semibold text-purple-900 mb-4 flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                            </svg>
                            Opción 2: Hipoteca sin bonificar + productos externos
                        </h4>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-purple-700">Cuota hipoteca:</span>
                                <span class="font-semibold text-purple-900">${formatNumber(resultados.cuotaSinBonificar)}€/mes</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-purple-700">Productos:</span>
                                <span class="font-semibold text-purple-900">${formatNumber(resultados.costeAnualExterno/12)}€/mes</span>
                            </div>
                            <div class="pt-3 border-t border-purple-200">
                                <div class="flex justify-between">
                                    <span class="font-semibold text-purple-900">Total mensual:</span>
                                    <span class="font-bold text-purple-900 text-lg">
                                        ${formatNumber(resultados.cuotaSinBonificar + resultados.costeAnualExterno/12)}€
                                    </span>
                                </div>
                            </div>
                            <div class="pt-2">
                                <div class="flex justify-between">
                                    <span class="text-sm text-purple-700">Coste total (${resultados.plazoRestante} años):</span>
                                    <span class="font-semibold text-purple-900">
                                        ${formatNumber(resultados.costeTotalOpcionExterna, 0)}€
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Información adicional -->
                <div class="bg-gray-50 rounded-xl p-6 fade-in">
                    <h4 class="font-semibold text-gray-800 mb-4 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-600">
                            <circle cx="12" cy="12" r="10"></circle>
                            <path d="M12 16v-4"></path>
                            <path d="M12 8h.01"></path>
                        </svg>
                        Análisis detallado
                    </h4>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <p class="text-sm text-gray-600 mb-2">Ahorro en intereses por bonificación:</p>
                            <p class="text-2xl font-bold text-green-600">
                                ${formatNumber(resultados.ahorroTotalIntereses, 0)}€
                            </p>
                            <p class="text-xs text-gray-500">en ${resultados.plazoRestante} años</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600 mb-2">Sobrecoste productos del banco:</p>
                            <p class="text-2xl font-bold text-red-600">
                                ${formatNumber(resultados.sobrecosteProductosBanco * resultados.plazoRestante, 0)}€
                            </p>
                            <p class="text-xs text-gray-500">en ${resultados.plazoRestante} años</p>
                        </div>
                    </div>
                    
                    <div class="mt-6 p-4 bg-amber-100 rounded-lg">
                        <p class="text-sm text-amber-800">
                            <strong>⚠️ Importante:</strong> Revisa que los costes externos sean realistas. Compara precios de seguros en comparadores online y asegúrate de incluir todos los costes (comisiones de tarjetas, mantenimiento de cuentas, etc.).
                        </p>
                    </div>
                </div>
            `;
        }

        // Event listeners
        document.getElementById('capitalPendiente').addEventListener('input', calcular);
        document.getElementById('plazoRestante').addEventListener('input', calcular);
        document.getElementById('tipoSinBonificar').addEventListener('input', calcular);
        document.getElementById('tipoBonificado').addEventListener('input', calcular);

        // Inicializar
        actualizarTablaProductos();
    </script>
</body>
</html>
